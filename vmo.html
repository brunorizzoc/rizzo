<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pesquisa de Iniciativas e Envolvidos</title>
    <style>
        /* Estilos CSS para a página */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Pesquisa de Iniciativas e Envolvidos</h1>
    <form id="searchForm">
        <label for="searchInput">Pesquisar:</label>
        <input type="text" id="searchInput" name="searchInput" placeholder="Digite sua pesquisa...">
        <button type="submit">Pesquisar</button>
        <label for="filtroIniciativa">Filtrar por Iniciativa:</label>
        <select id="filtroIniciativa">
            <option value="">Todas</option>
            <option value="LIS SAC">LIS SAC</option>
            <option value="EBR">EBR</option>
            <option value="TELHADO FÁBRICA">TELHADO FÁBRICA</option>
        </select>
        <label for="filtroCategoria">Filtrar por Categoria:</label>
        <select id="filtroCategoria">
            <option value="">Todas</option>
            <option value="A">A</option>
            <option value="B">B</option>
        </select>
        <label for="filtroStatus">Filtrar por Status:</label>
        <select id="filtroStatus">
            <option value="">Todos</option>
            <option value="Em andamento">Em andamento</option>
            <option value="Finalizado">Finalizado</option>
        </select>
    </form>

    <table id="resultsTable">
        <thead>
            <tr>
                <th>Iniciativa</th>
                <th>Estratégico</th>
                <th>Categoria</th>
                <th>Status</th>
                <th>Envovidos</th>
            </tr>
        </thead>
        <tbody id="resultsBody">
        </tbody>
    </table>

    <h2>Detalhes das Pessoas</h2>
    <table id="peopleTable">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Quantidade de Projetos</th>
                <th>Iniciativas</th>
            </tr>
        </thead>
        <tbody id="peopleBody">
        </tbody>
    </table>

    <script>
        // Dados das tabelas
        const iniciativas = [
            { CodIniciativa: 1, Iniciativa: 'LIS SAC', Estratégico: 'Impulsionar Processos Internos', Categoria: 'A', Status: 'Em andamento' },
            { CodIniciativa: 2, Iniciativa: 'EBR', Estratégico: 'Impulsionar Processos Fabris', Categoria: 'A', Status: 'Finalizado' },
            { CodIniciativa: 3, Iniciativa: 'TELHADO FÁBRICA', Estratégico: 'Manutenções Fabris', Categoria: 'B', Status: 'Em andamento' }
        ];

        const envolvidos = [
            { CodIniciativa: 1, Pessoa: 'Bruno Rizzo' },
            { CodIniciativa: 1, Pessoa: 'Flavio Rosa' },
            { CodIniciativa: 2, Pessoa: 'Gleice' },
            { CodIniciativa: 3, Pessoa: 'Gleice' },
            { CodIniciativa: 1, Pessoa: 'Daiane' },
            { CodIniciativa: 2, Pessoa: 'Jacob' },
            { CodIniciativa: 3, Pessoa: 'Katsui' },
            { CodIniciativa: 1, Pessoa: 'Rafael Henrique' },
            { CodIniciativa: 2, Pessoa: 'Marilyn Fietosa' },
            { CodIniciativa: 3, Pessoa: 'Rafael Henrique' },
            { CodIniciativa: 2, Pessoa: 'Bruno Rizzo' },
            { CodIniciativa: 3, Pessoa: 'Bruno Rizzo' }
        ];

        // Função para buscar os dados
        function search(event) {
            event.preventDefault();
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtroIniciativa = document.getElementById('filtroIniciativa').value;
            const filtroCategoria = document.getElementById('filtroCategoria').value;
            const filtroStatus = document.getElementById('filtroStatus').value;
            const filteredResults = [];

            iniciativas.forEach(iniciativa => {
                const envolvidosCount = envolvidos.filter(envolvido => envolvido.CodIniciativa === iniciativa.CodIniciativa).length;
                const iniciativaValues = Object.values(iniciativa).map(value => value.toString().toLowerCase());
                if (iniciativaValues.some(value => value.includes(searchTerm)) &&
                    (filtroIniciativa === '' || iniciativa.Iniciativa === filtroIniciativa) &&
                    (filtroCategoria === '' || iniciativa.Categoria === filtroCategoria) &&
                    (filtroStatus === '' || iniciativa.Status === filtroStatus)) {
                    filteredResults.push({
                        Iniciativa: iniciativa.Iniciativa,
                        Estratégico: iniciativa.Estratégico,
                        Categoria: iniciativa.Categoria,
                        Status: iniciativa.Status,
                        Envovidos: envolvidosCount
                    });
                }
            });

            displayResults(filteredResults);
            displayPeopleDetails();
        }

        function displayResults(results) {
            const resultsBody = document.getElementById('resultsBody');
            resultsBody.innerHTML = '';

            results.forEach(result => {
                resultsBody.innerHTML += `
                    <tr>
                        <td>${result.Iniciativa}</td>
                        <td>${result.Estratégico}</td>
                        <td>${result.Categoria}</td>
                        <td>${result.Status}</td>
                        <td>${result.Envovidos}</td>
                    </tr>
                `;
            });
        }

        function displayPeopleDetails() {
            const peopleDetails = {};

            envolvidos.forEach(envolvido => {
                if (!peopleDetails[envolvido.Pessoa]) {
                    peopleDetails[envolvido.Pessoa] = {
                        count: 1,
                        iniciativas: [iniciativas.find(iniciativa => iniciativa.CodIniciativa === envolvido.CodIniciativa).Iniciativa]
                    };
                } else {
                    peopleDetails[envolvido.Pessoa].count++;
                    peopleDetails[envolvido.Pessoa].iniciativas.push(iniciativas.find(iniciativa => iniciativa.CodIniciativa === envolvido.CodIniciativa).Iniciativa);
                }
            });

            const peopleBody = document.getElementById('peopleBody');
            peopleBody.innerHTML = '';

            Object.keys(peopleDetails).forEach(nome => {
                const { count, iniciativas } = peopleDetails[nome];
                peopleBody.innerHTML += `
                    <tr>
                        <td>${nome}</td>
                        <td>${count}</td>
                        <td>${iniciativas.join(', ')}</td>
                    </tr>
                `;
            });
        }

        document.getElementById('searchForm').addEventListener('submit', search);
    </script>
</body>
</html>
